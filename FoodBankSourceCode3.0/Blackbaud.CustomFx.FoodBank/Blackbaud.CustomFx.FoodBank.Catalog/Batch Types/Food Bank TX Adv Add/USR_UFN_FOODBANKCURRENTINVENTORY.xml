<SQLFunctionSpec
	xmlns="bb_appfx_sqlfunction"
	xmlns:common="bb_appfx_commontypes" 
	ID="df960eb4-0637-4fc8-8ef6-21222f8af36e"
	Name="USR_UFN_FOODBANKCURRENTINVENTORY"
	Description="Supports the FoodBankTXBatchVersusCurrentInvReconcile Data List"
	Author="Technical Training"
	DBFunctionName="USR_UFN_FOODBANKCURRENTINVENTORY"
	>

	<CreateFunctionSQL>
		<![CDATA[
CREATE FUNCTION [dbo].[USR_UFN_FOODBANKCURRENTINVENTORY]
(	
	@CONSTITUENTID UNIQUEIDENTIFIER
)
RETURNS TABLE 
AS
RETURN 
(
SELECT     C.ID AS FOODBANKID, C.NAME AS FOODBANKNAME, FI.ID AS FOODITEMID, FI.NAME AS FOODITEMNAME, 
                      SUM(CASE WHEN FBTH.FOODBANKTXTYPECODE = 0 THEN FBTD.QUANTITY ELSE FBTD.QUANTITY * - 1 END) AS CURRENTPRODINV
FROM         dbo.CONSTITUENT AS C INNER JOIN
                      dbo.USR_FOODBANKTXHEADER AS FBTH ON C.ID = FBTH.FOODBANKID INNER JOIN
                      dbo.USR_FOODBANKTXDETAIL AS FBTD ON FBTH.ID = FBTD.FOODBANKTXHEADERID INNER JOIN
                      dbo.USR_FOODITEM AS FI ON FBTD.FOODITEMID = FI.ID
WHERE C.ID = @CONSTITUENTID
GROUP BY C.ID, C.NAME, FI.NAME, FI.ID
)
		]]>
	</CreateFunctionSQL>

</SQLFunctionSpec>
